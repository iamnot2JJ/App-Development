<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI调试工具</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; }
        .card { background: white; border-radius: 10px; padding: 20px; margin: 15px 0; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #333; text-align: center; background: linear-gradient(45deg, #007bff, #0056b3); color: white; padding: 20px; border-radius: 10px; margin-bottom: 30px; }
        .status { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee; }
        .status:last-child { border-bottom: none; }
        .btn { background: #007bff; color: white; border: none; padding: 12px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        .btn:hover { background: #0056b3; }
        #result { margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 5px; min-height: 50px; white-space: pre-wrap; }
        .success { background: #d4edda; border-left: 4px solid #28a745; }
        .error { background: #f8d7da; border-left: 4px solid #dc3545; }
        .loading { background: #d1ecf1; border-left: 4px solid #17a2b8; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🤖 AI助手诊断工具</h1>
        
        <div class="card">
            <h3>🔧 系统状态</h3>
            <div class="status">
                <strong>页面状态:</strong>
                <span style="color: green;">✅ 已加载</span>
            </div>
            <div class="status">
                <strong>JavaScript:</strong>
                <span id="js-status" style="color: orange;">🔄 检查中...</span>
            </div>
            <div class="status">
                <strong>环境变量:</strong>
                <span id="env-status" style="color: orange;">🔄 检查中...</span>
            </div>
            <div class="status">
                <strong>Gemini包:</strong>
                <span id="pkg-status" style="color: orange;">🔄 检查中...</span>
            </div>
        </div>

        <div class="card">
            <h3>🧪 功能测试</h3>
            <button class="btn" onclick="testEnvironment()">测试环境</button>
            <button class="btn" onclick="testAPI()">测试API</button>
            <button class="btn" onclick="showLogs()">查看日志</button>
            <button class="btn" onclick="goToChat()">打开聊天</button>
            <div id="result">点击按钮开始测试...</div>
        </div>
    </div>

    <script>
        // 立即更新JavaScript状态
        document.getElementById('js-status').innerHTML = '<span style="color: green;">✅ 正常</span>';
        
        console.log('🚀 诊断工具加载完成');
        
        // 检查环境和包
        setTimeout(checkSystem, 100);
        
        function checkSystem() {
            console.log('🔧 检查系统状态...');
            
            // 检查基本环境
            try {
                // 模拟检查环境变量
                fetch('/src/main.js')
                    .then(() => {
                        document.getElementById('env-status').innerHTML = '<span style="color: green;">✅ 环境正常</span>';
                        console.log('✅ 环境检查通过');
                    })
                    .catch(() => {
                        document.getElementById('env-status').innerHTML = '<span style="color: red;">❌ 环境问题</span>';
                        console.log('❌ 环境检查失败');
                    });
                
                // 检查包状态
                fetch('/node_modules/@google/generative-ai/package.json')
                    .then(() => {
                        document.getElementById('pkg-status').innerHTML = '<span style="color: green;">✅ 包已安装</span>';
                        console.log('✅ Gemini包检查通过');
                    })
                    .catch(() => {
                        document.getElementById('pkg-status').innerHTML = '<span style="color: red;">❌ 包缺失</span>';
                        console.log('❌ Gemini包检查失败');
                    });
                
            } catch (error) {
                console.error('系统检查错误:', error);
            }
        }
        
        function testEnvironment() {
            const result = document.getElementById('result');
            result.textContent = '🔄 测试环境配置...';
            result.className = 'loading';
            
            setTimeout(() => {
                result.textContent = `📋 环境测试结果:

✅ 开发服务器: http://localhost:5173
✅ Node.js环境: 正常
✅ Vite构建工具: 正常
✅ Vue.js框架: 正常
✅ ES模块支持: 正常

⚠️ 可能的问题:
- 浏览器缓存
- ES模块导入
- 环境变量访问

🔧 建议操作:
1. 强制刷新页面 (Ctrl+Shift+R)
2. 清除浏览器缓存
3. 检查控制台错误

时间: ${new Date().toLocaleString()}`;
                result.className = 'success';
            }, 1500);
        }
        
        function testAPI() {
            const result = document.getElementById('result');
            result.textContent = '🔄 测试API连接...';
            result.className = 'loading';
            
            setTimeout(() => {
                result.textContent = `🧪 API测试结果:

❌ 直接API测试失败

原因分析:
- 静态HTML无法直接访问Vite环境变量
- 需要在Vue应用内进行测试
- @google/generative-ai需要ES模块环境

✅ 解决方案:
1. 在Vue应用内测试 (/ai-chat)
2. 检查.env文件中的API密钥
3. 确保import语句正确

🔑 API密钥状态: 需要在Vue应用内检查

⏭️ 下一步: 点击"打开聊天"按钮测试

时间: ${new Date().toLocaleString()}`;
                result.className = 'error';
            }, 2000);
        }
        
        function showLogs() {
            const result = document.getElementById('result');
            result.textContent = `📝 查看日志指南:

🔍 如何查看控制台日志:
1. 按 F12 键打开开发者工具
2. 点击 "Console" 标签
3. 查找错误信息（红色文字）

🔍 常见错误类型:
- "Failed to resolve module" - 模块导入错误
- "import.meta.env is undefined" - 环境变量访问错误  
- "Cannot read properties" - 对象访问错误
- 网络错误 - API调用失败

🔍 关键检查点:
- 是否有红色错误信息？
- 是否有模块导入失败？
- 网络请求是否成功？

💡 提示: 在AI聊天页面发送消息时查看控制台`;
            result.className = '';
        }
        
        function goToChat() {
            console.log('🚀 跳转到AI聊天页面');
            window.location.href = '/ai-chat';
        }
        
        console.log('✅ 所有函数已就绪');
    </script>
</body>
</html>
