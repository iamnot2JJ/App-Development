<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gemini API Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 900px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f8f9fa;
      }
      .header {
        text-align: center;
        background: linear-gradient(135deg, #007bff, #0056b3);
        color: white;
        padding: 30px;
        border-radius: 10px;
        margin-bottom: 30px;
      }
      .test-box {
        margin: 20px 0;
        padding: 20px;
        border: 2px solid #ddd;
        border-radius: 10px;
        background: white;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .test-box h3 {
        margin-top: 0;
        color: #333;
        border-bottom: 2px solid #007bff;
        padding-bottom: 10px;
      }
      .status-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 0;
        border-bottom: 1px solid #eee;
      }
      .status-item:last-child {
        border-bottom: none;
      }
      .success {
        background-color: #d4edda;
        border-color: #c3e6cb;
      }
      .error {
        background-color: #f8d7da;
        border-color: #f5c6cb;
      }
      .loading {
        background-color: #d1ecf1;
        border-color: #bee5eb;
      }
      button {
        padding: 15px 30px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
        transition: all 0.3s;
      }
      button:hover {
        background: #0056b3;
        transform: translateY(-2px);
      }
      #response {
        margin-top: 15px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 8px;
        white-space: pre-wrap;
        border: 1px solid #ddd;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>ğŸ¤– Gemini API æµ‹è¯•é¡µé¢</h1>
      <p>è¯Šæ–­AIåŠ©æ‰‹é—®é¢˜çš„ä¸“ç”¨å·¥å…·</p>
    </div>

    <div class="test-box">
      <h3>ğŸ“‹ ç¯å¢ƒæ£€æŸ¥</h3>
      <div class="status-item">
        <strong>API Key çŠ¶æ€:</strong>
        <span id="api-key-status" style="font-weight: bold">ğŸ”„ æ£€æŸ¥ä¸­...</span>
      </div>
      <div class="status-item">
        <strong>Gemini åŒ…çŠ¶æ€:</strong>
        <span id="package-status" style="font-weight: bold">ğŸ”„ æ£€æŸ¥ä¸­...</span>
      </div>
      <div class="status-item">
        <strong>ç½‘ç»œè¿æ¥:</strong>
        <span id="network-status" style="font-weight: bold">ğŸ”„ æ£€æŸ¥ä¸­...</span>
      </div>
    </div>

    <div class="test-box">
      <h3>ğŸ§ª API åŠŸèƒ½æµ‹è¯•</h3>
      <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æµ‹è¯•Gemini APIæ˜¯å¦æ­£å¸¸å·¥ä½œï¼š</p>
      <button onclick="testGeminiAPI()">ğŸš€ æµ‹è¯• Gemini API</button>
      <div id="response"></div>
    </div>

    <div class="test-box">
      <h3>ğŸ“ è°ƒè¯•ä¿¡æ¯</h3>
      <p>è¯·æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…æ§åˆ¶å°ï¼ˆæŒ‰F12é”®ï¼‰æŸ¥çœ‹è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—ã€‚</p>
      <button onclick="showDebugInfo()">ğŸ“Š æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯</button>
      <div id="debug-info"></div>
    </div>

    <script type="module">
      console.log('ğŸš€ æµ‹è¯•é¡µé¢åŠ è½½å¼€å§‹...')

      // æ£€æŸ¥ç¯å¢ƒå˜é‡
      console.log('ğŸ”§ æ£€æŸ¥ç¯å¢ƒå˜é‡...')
      const apiKey = import.meta.env.VITE_GEMINI_API_KEY
      console.log('ğŸ”‘ API Key:', apiKey ? 'å·²æ‰¾åˆ°: ' + apiKey.substring(0, 10) + '...' : 'æœªæ‰¾åˆ°')

      const apiStatus = document.getElementById('api-key-status')
      const packageStatus = document.getElementById('package-status')
      const networkStatus = document.getElementById('network-status')

      if (apiKey) {
        apiStatus.textContent = 'âœ… å·²é…ç½® (' + apiKey.substring(0, 10) + '...)'
        apiStatus.style.color = 'green'
        console.log('âœ… API Key çŠ¶æ€: å·²é…ç½®')
      } else {
        apiStatus.textContent = 'âŒ æœªé…ç½®'
        apiStatus.style.color = 'red'
        console.log('âŒ API Key çŠ¶æ€: æœªé…ç½®')
      }

      // æ£€æŸ¥ç½‘ç»œ
      console.log('ğŸŒ æ£€æŸ¥ç½‘ç»œè¿æ¥...')
      try {
        const response = await fetch('https://www.google.com/favicon.ico', { mode: 'no-cors' })
        networkStatus.textContent = 'âœ… ç½‘ç»œæ­£å¸¸'
        networkStatus.style.color = 'green'
        console.log('âœ… ç½‘ç»œçŠ¶æ€: æ­£å¸¸')
      } catch (error) {
        networkStatus.textContent = 'âŒ ç½‘ç»œè¿æ¥é—®é¢˜'
        networkStatus.style.color = 'red'
        console.log('âŒ ç½‘ç»œçŠ¶æ€: è¿æ¥é—®é¢˜', error)
      }

      // æ£€æŸ¥ Gemini åŒ…
      console.log('ğŸ“¦ æ£€æŸ¥ Gemini åŒ…...')
      try {
        const { GoogleGenerativeAI } = await import('@google/generative-ai')
        packageStatus.textContent = 'âœ… å·²æ­£ç¡®å®‰è£…'
        packageStatus.style.color = 'green'
        console.log('âœ… Gemini åŒ…çŠ¶æ€: å·²å®‰è£…')

        // å…¨å±€æµ‹è¯•å‡½æ•°
        window.testGeminiAPI = async function () {
          console.log('ğŸ§ª å¼€å§‹APIæµ‹è¯•...')
          const responseDiv = document.getElementById('response')
          responseDiv.innerHTML = 'â³ æ­£åœ¨æµ‹è¯• APIè¿æ¥...'
          responseDiv.className = 'loading'

          try {
            if (!apiKey) {
              throw new Error('API Key æœªé…ç½®ï¼Œè¯·æ£€æŸ¥.envæ–‡ä»¶')
            }

            console.log('ğŸ”‘ ä½¿ç”¨API Key:', apiKey.substring(0, 10) + '...')

            const genAI = new GoogleGenerativeAI(apiKey)
            console.log('âœ… GoogleGenerativeAI å®ä¾‹åˆ›å»ºæˆåŠŸ')

            const model = genAI.getGenerativeModel({ model: 'gemini-pro' })
            console.log('âœ… æ¨¡å‹é…ç½®æˆåŠŸ')

            console.log('ğŸ“¤ å‘é€æµ‹è¯•æ¶ˆæ¯åˆ°Gemini...')
            const result = await model.generateContent(
              'Hello! Please respond with "API test successful" in English.'
            )
            console.log('ğŸ“¦ æ”¶åˆ°åŸå§‹ç»“æœ:', result)

            const response = await result.response
            console.log('ğŸ“„ å¤„ç†å“åº”å¯¹è±¡:', response)

            const text = response.text()
            console.log('ğŸ“ æå–æ–‡æœ¬å†…å®¹:', text)

            responseDiv.innerHTML = `âœ… API æµ‹è¯•æˆåŠŸï¼\n\nğŸ¤– Geminiå›å¤: ${text}\n\nâ° æµ‹è¯•æ—¶é—´: ${new Date().toLocaleString()}`
            responseDiv.className = 'success'

            console.log('âœ… APIæµ‹è¯•å®Œå…¨æˆåŠŸ!')
          } catch (error) {
            console.error('âŒ APIæµ‹è¯•å¤±è´¥:', error)
            responseDiv.innerHTML = `âŒ API æµ‹è¯•å¤±è´¥!\n\né”™è¯¯ç±»å‹: ${
              error.name || 'Unknown'
            }\né”™è¯¯ä¿¡æ¯: ${error.message}\n\nè¯¦ç»†ä¿¡æ¯: ${
              error.stack || 'æ— è¯¦ç»†ä¿¡æ¯'
            }\n\nâ° æµ‹è¯•æ—¶é—´: ${new Date().toLocaleString()}`
            responseDiv.className = 'error'
          }
        }

        // è°ƒè¯•ä¿¡æ¯å‡½æ•°
        window.showDebugInfo = function () {
          console.log('ğŸ“Š æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯...')
          const debugDiv = document.getElementById('debug-info')
          debugDiv.innerHTML = `
                    <h4>ğŸ”§ ç³»ç»Ÿä¿¡æ¯:</h4>
                    <p><strong>ç”¨æˆ·ä»£ç†:</strong> ${navigator.userAgent}</p>
                    <p><strong>å½“å‰URL:</strong> ${window.location.href}</p>
                    <p><strong>API Key:</strong> ${
                      apiKey ? 'å·²é…ç½® (' + apiKey.length + ' å­—ç¬¦)' : 'æœªé…ç½®'
                    }</p>
                    <p><strong>å®Œæ•´API Key:</strong> ${apiKey || 'æ— '}</p>
                    <h4>ğŸŒ ç¯å¢ƒå˜é‡:</h4>
                    <pre>${JSON.stringify(import.meta.env, null, 2)}</pre>
                `
        }
      } catch (error) {
        packageStatus.textContent = 'âŒ å®‰è£…å¤±è´¥: ' + error.message
        packageStatus.style.color = 'red'
        console.error('âŒ Gemini åŒ…åŠ è½½é”™è¯¯:', error)

        // å¦‚æœåŒ…åŠ è½½å¤±è´¥ï¼Œåˆ›å»ºä¸€ä¸ªç®€å•çš„æµ‹è¯•å‡½æ•°
        window.testGeminiAPI = function () {
          const responseDiv = document.getElementById('response')
          responseDiv.innerHTML = `âŒ æ— æ³•æµ‹è¯•API\n\nGeminiåŒ…æœªæ­£ç¡®å®‰è£…: ${error.message}`
          responseDiv.className = 'error'
        }
      }

      console.log('âœ… æµ‹è¯•é¡µé¢åˆå§‹åŒ–å®Œæˆ')
    </script>
  </body>
</html>
